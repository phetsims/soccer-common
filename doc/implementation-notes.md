# Soccer Common - Implementation Notes

## Table of Contents

- [Introduction](#introduction)
- [General Considerations](#general-considerations)
    - [Model-View Transforms](#model-view-transforms)
    - [Query Parameters](#query-parameters)
    - [Memory Management](#memory-management)
    - [Measures of Center & Spread](#measures-of-center--spread)
        - [Workarounds for Abundant and Inconsistent Intermediate Values in Axon Callbacks](#workarounds-for-abundant-and-inconsistent-intermediate-values-in-axon-callbacks)
- [Plot Nodes](#plot-nodes)
    - [Main Architecture & Scenes](#main-architecture--scenes)
    - [The Variability Measurements (range, mad, iqr)](#the-variability-measurements-range-mad-iqr)
- [Sound](#sound)
- [Alternative Input](#alternative-input)
- [PhET-iO](#phet-io)

## Introduction

This document contains notes related to the implementation of the common code repo _soccer-common_, which provides model and view components for "soccer" related simulations. These
are typically used to show random values generated by kick distances. 

This document is not an
exhaustive description of the implementation. The intention is to provide a concise high-level overview, and to
supplement the internal documentation (source code comments) and external documentation (design documents).

Before reading this document, please read:

- [model.md](./model.md), a high-level description of the model

In addition to this document, you are encouraged to read:

- [PhET Development Overview](https://github.com/phetsims/phet-info/blob/main/doc/phet-development-overview.md)
- [PhET Software Design Patterns](https://github.com/phetsims/phet-info/blob/main/doc/phet-software-design-patterns.md)

## General Considerations

### Model-View Transforms

This simulation makes use of a model-view transform to map model coordinates (horizontally: meters, vertically: number
of data points) to view coordinates in the soccer area. The transform is defined by the client and passed in.

### Query Parameters

There are no query parameters specific to this common code repo. One of the usages (Center and Variability) has a query
parameter and preference to select the maximum number of kicks.

### Memory Management

- **Dynamic allocation:** All objects in this repo are allocated at startup, and exist for the lifetime of the
  simulation. We use `isActiveProperty` flags or other phase Property flags to indicate whether they appear in the sim
  and participate in the model.
- **Listeners**: All uses of `link`, `addListener`, etc. do NOT need a corresponding `unlink`, `removeListener`, etc.
- **dispose**: A lint rule prevents the usage of the term dispose in this repo, disposal is not supported and should not
  be used.

### Main Architecture & Scenes

- The central model is `SoccerSceneModel`, which contains `SoccerBall` instances, `Kicker` instances, and other Emitters
  and stateful data.

## Alternative Input

To identify focus traversal order, search for `pdomOrder`.

To identify sim-specific support for keyboard input, search for `tagName`. These classes have custom input listeners
that handle keyboard events (e.g. `KeyboardDragListener`).

This repo does not use hotkeys.

Setting focus for tools is done via tab traversal. This sim does not use `GrabDragInteraction` since at the time of
writing that did not support the "group" interaction design.

This sim uses "group" interaction for the soccer balls, where the user first selects an object via the
arrow keys, then presses enter/spacebar to grab the soccer ball.

## PhET-iO

The PhET-iO instrumentation of this sim is relatively straightforward. As described
in [Memory Management](#memory-management), everything in this sim is created at startup, and exists for the lifetime of
the sim. So there is no sim-specific use of PhetioGroup or PhetioCapsule. See examples.md for examples of how to use the
PhET-iO API.

### KickDistributionStrategy

The SoccerSceneModel has a KickDistributionStrategy which determines where the kicks will fall. Each kick location is
determined
at the time of the kick (not predetermined). For the random skew strategy, it re-randomizes to left/right skew on reset.
PhET-iO provides a rich API for specifying different types of distributions.

### SoccerBall

A soccer ball is like a data point that has a null value until it lands, then it takes a numerical value.
See SoccerBallPhase for the full list of phases a soccer ball may take.